# Headers de sécurité par défaut
add_header X-Content-Type-Options nosniff always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Map to detect bots and exclude them from rate limiting
map $http_user_agent $limit_key {
    default $binary_remote_addr;
    ~*(googlebot|bingbot|slurp|duckduckbot|baiduspider|yandexbot|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora link preview|showyoubot|outbrain|pinterest|slackbot|vkShare|W3C_Validator|whatsapp) "";
}

# Rate limiting zones (bots are excluded via $limit_key)
limit_req_zone $limit_key zone=login:10m rate=10r/m;
limit_req_zone $limit_key zone=api:10m rate=30r/m;
limit_req_zone $limit_key zone=general:10m rate=60r/m;
limit_conn_zone $limit_key zone=conn_limit_per_ip:10m;
